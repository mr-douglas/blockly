<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Generate Turtle Python Programs with Blockly</title>
    <script src="blockly_uncompressed.js"></script>

    <script src="generators/python.js"></script>
    <script src="generators/python/colour.js"></script>
    <script src="generators/python/custom_code.js"></script>
    <script src="generators/python/ev3.js"></script>
    <script src="generators/python/lists.js"></script>
    <script src="generators/python/logic.js"></script>
    <script src="generators/python/loops.js"></script>
    <script src="generators/python/math.js"></script>
    <script src="generators/python/procedures.js"></script>
    <script src="generators/python/text.js"></script>
    <script src="generators/python/turtle.js"></script>
    <script src="generators/python/variables.js"></script>
    <script src="generators/python/variables_dynamic.js"></script>
    <script src="blocks/colour.js"></script>
    <script src="blocks/custom_code.js"></script>
    <script src="blocks/ev3.js"></script>
    <script src="blocks/lists.js"></script>
    <script src="blocks/logic.js"></script>
    <script src="blocks/loops.js"></script>
    <script src="blocks/math.js"></script>
    <script src="blocks/procedures.js"></script>
    <script src="blocks/text.js"></script>
    <script src="blocks/turtle.js"></script>
    <script src="blocks/variables.js"></script>
    <script src="blocks/variables_dynamic.js"></script>
    <script src="msg/js/en.js"></script>
    <script>
      Blockly.HSV_SATURATION = 0.9;
      Blockly.HSV_VALUE = 0.7;
      
      var workspace;
      
      function updatePython() {
        if (workspace!=null)
        {
          document.getElementById('pythonDiv').innerHTML = Blockly.Python.workspaceToCode(workspace);
        }
      }
      
      
      function copyToClipboard() {
        var tempInput = document.createElement("textarea");
        generatedPython = Blockly.Python.workspaceToCode(workspace);
        tempInput.value = generatedPython;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand("copy");
        document.body.removeChild(tempInput);
        alert("Copied the text:\n" + generatedPython);
      }
      
      function saveToFile() {
        generatedPython = Blockly.Python.workspaceToCode(workspace);
        var textFileAsBlob = new Blob([ generatedPython ], { type: 'text/plain' })
        var fileNameToSaveAs = prompt("Enter a file name for your Python file","my_python_program") + ".py";
        var downloadLink = document.createElement("a");
        downloadLink.download = fileNameToSaveAs;
        downloadLink.innerHTML = "Download File";
        if (window.webkitURL != null) {
          // Chrome allows the link to be clicked without actually adding it to the DOM.
          downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob);
        } else {
          // Firefox requires the link to be added to the DOM before it can be clicked.
          downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
          downloadLink.onclick = destroyClickedElement;
          downloadLink.style.display = "none";
          document.body.appendChild(downloadLink);
        }
        downloadLink.click();
        if (downloadLink.parentElement!=null){
          document.body.removeChild(downloadLink);
        }
      }
    </script>
    <style>
    
      #pythonContainer
      {
        float: right;
        height: calc(100vh - 17px);
        width: 25vw;
      }
      
      #pythonDiv
      {
        height: calc(100% - 40px);
        background-color: #222;
        color: lightgreen;      
        font-family: monospace;
        font-weight: bold;
        width: inherit;
        resize: none;
        white-space: pre;
        border: none;
        padding: 0px;
      }
      
      #pythonContainer button
      {
        display: inline-block;
        width: calc(25vw/2 - 4px);
        height: 35px;
        margin-left: 2px;
      }
      
      #blocklyDiv
      {
        height: calc(100vh - 17px);
        width: 75%;
      }
    </style>
  </head>
  <body>
    <xml id="toolbox" style="display: none">
      <category name="Maths" colour='%{BKY_MATH_HUE}'>
        <category name="Basics" colour='%{BKY_MATH_HUE}'>
          <block type="math_number"><field name="NUM">0</field></block>
          <block type="math_arithmetic"><field name="OP">ADD</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block>
          <block type="math_arithmetic"><field name="OP">MINUS</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block>
          <block type="math_arithmetic"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block>
          <block type="math_arithmetic"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block>
          <block type="math_arithmetic"><field name="OP">POWER</field><value name="A"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block>
          <block type="math_single"><value name="NUM"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block>
          <block type="math_constant"></block>
        </category>
        <category name="Random" colour='%{BKY_MATH_HUE}'>
          <block type="math_random_int"><value name="FROM"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="TO"><shadow type="math_number"><field name="NUM">100</field></shadow></value></block>
          <block type="math_random_float"></block>
        </category>
        <category name="Trigonometry" colour='%{BKY_MATH_HUE}'>
          <block type="math_trig"><field name="OP">SIN</field> <value name="NUM"><shadow type="math_number"><field name="NUM">45</field></shadow></value></block>
          <block type="math_trig"><field name="OP">COS</field> <value name="NUM"><shadow type="math_number"><field name="NUM">45</field></shadow></value></block>
          <block type="math_trig"> <field name="OP">TAN</field> <value name="NUM"><shadow type="math_number"><field name="NUM">45</field></shadow></value></block>
          <block type="math_inv_trig"><field name="OP">ASIN</field> <value name="NUM"><shadow type="math_constant"><field name="CONSTANT">SQRT1_2</field></shadow></value></block>
          <block type="math_inv_trig"><field name="OP">ACOS</field> <value name="NUM"><shadow type="math_constant"><field name="CONSTANT">SQRT1_2</field></shadow></value></block>
          <block type="math_inv_trig"> <field name="OP">ATAN</field> <value name="NUM"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block>
        </category>
        <category name="Other" colour='%{BKY_MATH_HUE}'>
          <block type="math_number_property"><value name="NUMBER_TO_CHECK"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block>      
          <block type="math_round"><value name="NUM"><shadow type="math_number"><field name="NUM">3.1</field></shadow></value></block>
          <block type="math_on_list"></block>
          <block type="math_modulo"><value name="DIVIDEND"><shadow type="math_number"><field name="NUM">64</field></shadow></value><value name="DIVISOR"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block>
          <block type="math_constrain"><value name="VALUE"><shadow type="math_number"><field name="NUM">50</field></shadow></value><value name="LOW"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="HIGH"><shadow type="math_number"><field name="NUM">100</field></shadow></value></block>
        </category>
      </category>
      <category colour='%{BKY_TEXTS_HUE}' name="Input/Output">
        <block type="text_print"><value name="TEXT"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block>
        <block type="text_prompt_ext"><value name="TEXT"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block>
      </category>
      <category colour='%{BKY_TEXTS_HUE}' name="Strings (Text)">
        <block type="text"></block>
        <block type="text_join"></block>
        <block type="text_append"><value name="TEXT"><shadow type="text"></shadow></value></block>
        <block type="text_length"><value name="VALUE"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block>
        <block type="text_isEmpty"><value name="VALUE"><shadow type="text"><field name="TEXT"></field></shadow></value></block>
        <block type="text_indexOf"><value name="VALUE"><block type="variables_get"><field name="VAR">text</field></block></value><value name="FIND"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block>
        <block type="text_charAt"><value name="VALUE"><block type="variables_get"><field name="VAR">text</field></block></value></block>
        <block type="text_getSubstring"><value name="STRING"><block type="variables_get"><field name="VAR">text</field></block></value></block>
        <block type="text_changeCase"><value name="TEXT"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block>
        <block type="text_trim"><value name="TEXT"><shadow type="text"><field name="TEXT">abc</field></shadow></value></block>
      </category>
      <sep></sep>
      <category name="Selection (If/Else) and Logic" colour='%{BKY_LOGIC_HUE}'>
        <block type="controls_if"></block>
        <block type="logic_compare"></block>
        <block type="logic_operation"></block>
        <block type="logic_negate"></block>
        <block type="logic_boolean"></block>
        <block type="logic_null"></block>
      </category>
      <category name="Iteration (Loops)" colour='%{BKY_LOOPS_HUE}'>
        <block type="controls_repeat_ext"><value name="TIMES"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block>
        <block type="controls_whileUntil"></block>
        <block type="controls_for"><value name="FROM"><shadow type="math_number"><field name="NUM">1</field></shadow></value><value name="TO"><shadow type="math_number"><field name="NUM">10</field></shadow></value><value name="BY"><shadow type="math_number"><field name="NUM">1</field></shadow></value></block>
        <block type="controls_forEach"></block>
        <block type="controls_flow_statements"></block>
      </category>
      <sep></sep>
      <category colour='%{BKY_LISTS_HUE}' name="Lists">
        <block type="lists_create_with"><mutation items="0"></mutation></block>
        <block type="lists_create_with"></block>
        <block type="lists_repeat"><value name="NUM"><shadow type="math_number"><field name="NUM">5</field></shadow></value></block>
        <block type="lists_length"></block>
        <block type="lists_isEmpty"></block>
        <block type="lists_indexOf"><value name="VALUE"><block type="variables_get"><field name="VAR">list</field></block></value></block>
        <block type="lists_getIndex"><value name="VALUE"><block type="variables_get"><field name="VAR">list</field></block></value></block>
        <block type="lists_setIndex"><value name="LIST"><block type="variables_get"><field name="VAR">list</field></block></value></block>
        <block type="lists_getSublist"><value name="LIST"><block type="variables_get"><field name="VAR">list</field></block></value></block>
        <block type="lists_split"><value name="DELIM"><shadow type="text"><field name="TEXT">,</field></shadow></value></block>
        <block type="lists_sort"></block>
      </category>
      <category colour='%{BKY_VARIABLES_HUE}' custom="VARIABLE" name="Variables"></category>
      <category colour='%{BKY_PROCEDURES_HUE}' custom="PROCEDURE" name="Functions"></category>
      <sep></sep>
      <category name="Turtle" colour='%{BKY_COLOUR_HUE}'>
        <block type="turtle_move"><value name="DISTANCE"><shadow type="math_number"><field name="NUM">100</field></shadow></value></block>
        <block type="turtle_turn"><value name="ANGLE"><shadow type="math_number"><field name="NUM">45</field></shadow></value></block>
        <block type="turtle_turn_left"></block>
        <block type="turtle_turn_right"></block>
        <block type="turtle_goto"><value name="X"><shadow type="math_number"><field name="NUM">0</field></shadow></value><value name="Y"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block>
        <block type="turtle_set_speed"></block>
        <block type="turtle_pen_up_down"></block>
        <block type="turtle_pen_colour"></block>
        <block type="turtle_fill_colour"></block>
        <block type="turtle_set_pen_size"></block>
        <block type="turtle_set_direction_four"></block>
        <block type="turtle_set_direction_angle"></block>
        <block type="turtle_set_direction"></block>
        <block type="turtle_get_coord"></block>
        <block type="colour_picker"></block>
        <block type="colour_random"></block>
        <block type="colour_rgb"><value name="RED"><shadow type="math_number"><field name="NUM">100</field></shadow></value><value name="GREEN"><shadow type="math_number"><field name="NUM">50</field></shadow></value><value name="BLUE"><shadow type="math_number"><field name="NUM">0</field></shadow></value></block>
        <block type="colour_blend"><value name="COLOUR1"><shadow type="colour_picker"><field name="COLOUR">#ff0000</field></shadow></value><value name="COLOUR2"><shadow type="colour_picker"><field name="COLOUR">#3333ff</field></shadow></value><value name="RATIO"><shadow type="math_number"><field name="NUM">0.5</field></shadow></value></block>
      </category>
      <category colour='90' name="EV3" disabled="true">
        <block type="ev3_beep"></block>
        <label text="Coming Soon!"></label>
      </category>
      <category colour='270' name="Raspberry Pi">
        <label text="Coming Soon!"></label>
      </category>
      <sep></sep>
      <category colour='black' name="Insert Your Own Code">
        <block type="insert_user_code"></block>
      </category>
    </xml>
    <div id="pythonContainer">
      <textarea readonly id="pythonDiv">
      </textarea>
      <div>
        <button onclick="copyToClipboard()">Copy to clipboard</button> <button onclick="saveToFile()">Save to file</button>
      </div>
    </div>
    <div id="blocklyDiv"></div>
    <script>
      workspace = Blockly.inject('blocklyDiv',{toolbox: document.getElementById('toolbox'),zoom:{controls: true,wheel: true,startScale: 1.0,maxScale: 3,minScale: 0.3,scaleSpeed: 1.025},grid: {spacing: 20, length: 3, colour: '#222', snap: false},trashcan: true,renderer:'thrasos'});
      workspace.addChangeListener(updatePython);
    </script>
  </body>
</html>